# 🚀 后端服务器启动说明

## ✅ 问题已修复

已修复以下问题：
- ✅ `regeneratorRuntime is not defined` 错误
- ✅ bat 文件闪退问题
- ✅ 端口占用问题
- ✅ shell 安全警告

---

## 📦 首次使用（重要）

**第一次运行前，必须先安装依赖：**

```bash
cd nodejsn73cv
npm install
```

这会自动安装 `babel-polyfill` 等必需依赖。

---

## 🎯 推荐启动方式

### 方法 1：Node.js 脚本（最推荐）

**HTTPS 模式（真机调试）**：
```bash
cd nodejsn73cv
node start-https.js
```

**HTTP 模式（开发环境）**：
```bash
cd nodejsn73cv
node start-http.js
```

**优势**：
- ✅ 不会闪退
- ✅ 自动清理占用端口
- ✅ 彩色输出，日志清晰
- ✅ 详细的错误提示
- ✅ 跨平台支持

---

### 方法 2：npm 脚本

```bash
cd nodejsn73cv

# HTTPS 模式
npm run https

# HTTP 模式
npm run http
```

---

### 方法 3：双击 bat 文件（Windows）

1. 双击 `一键启动HTTPS.bat` 或 `一键启动HTTP.bat`
2. 如果闪退，使用方法 1 或 2

---

## 🔧 启动脚本功能

### start-https.js 自动完成：

1. ✅ 检查 Node.js 环境
2. ✅ 清理占用的端口（8443、8080）
3. ✅ 安装项目依赖（首次运行）
4. ✅ 检测本机局域网 IP
5. ✅ 更新小程序配置文件
6. ✅ 生成 SSL 证书
7. ✅ 编译项目代码
8. ✅ 启动 HTTPS 服务器

### start-http.js 自动完成：

1. ✅ 检查 Node.js 环境
2. ✅ 清理占用的端口（8080）
3. ✅ 安装项目依赖（首次运行）
4. ✅ 检测本机局域网 IP
5. ✅ 更新小程序配置文件
6. ✅ 编译项目代码
7. ✅ 启动 HTTP 服务器

---

## 📝 运行示例

### Windows PowerShell：

```powershell
PS C:\Users\YourName\Desktop\项目目录> cd nodejsn73cv
PS C:\Users\YourName\Desktop\项目目录\nodejsn73cv> node start-https.js

========================================
🏠 学生宿舍管理系统 - HTTPS 服务器
========================================

Node.js 版本: v25.1.0
操作系统: win32 x64

========================================
📦 检查项目依赖
========================================
✅ 依赖已安装

========================================
🌐 配置本机 IP 地址
========================================
✅ 检测到本机 IP: 192.168.1.100
✅ 已更新小程序配置文件

========================================
🔐 配置 SSL 证书
========================================
✅ SSL 证书已存在

========================================
🚀 启动 HTTPS 服务器
========================================

📝 编译项目...
✅ 编译完成

🚀 服务器启动成功！
📡 HTTPS 服务器运行在: https://192.168.1.100:8443
📱 小程序访问地址: https://192.168.1.100:8443/nodejsn73cv/

按 Ctrl+C 停止服务器
```

---

## ⚠️ 常见问题

### Q1: 提示 "regeneratorRuntime is not defined"

**A**: 已修复！确保运行了 `npm install` 安装 `babel-polyfill`

### Q2: 端口被占用

**A**: Node.js 脚本会自动清理端口，直接运行即可

### Q3: bat 文件闪退

**A**: 使用 Node.js 脚本代替：
```bash
node start-https.js
```

### Q4: 找不到 node 命令

**A**: 确保已安装 Node.js 并添加到 PATH

---

## 🛑 停止服务器

按 `Ctrl + C` 停止服务器

---

## 📞 技术支持

如遇问题，查看：
- [Windows使用指南.md](../Windows使用指南.md)
- [快速启动.md](../快速启动.md)

---

**最后更新**: 2025-11-12  
**适用版本**: Node.js v14+

